import matplotlib.pyplot as plt
import numpy as np
from invlaplace import invlaplace

# Definindo os parâmetros
N = 10000
tD = np.linspace(1e-1,1e4,N)
cD = 1
Ceuler=0.5772
cde2s = np.array([1e2, 1e5, 1e10, 1e15, 1e20, 1e30, 1e40, 1e50, 1e60])
pwd = np.zeros((len(cde2s), len(tD)))
pwReal = np.array([2.16,3.18,5.61,7.67,10.28,12.71,15.33,17.76,20.19,22.62,24.86,27.11,31.97,37.19,41.13,45.98,56.72,63.26,69.05,75.59,80.93,89.72,97.76,106.17,114.03,122.06,131.6,150.66,167.87,186.01,202.46,216.49,231.08,245.68,260.63,271.29,284.95,296.73,305.52,324.23,338.26,350.42,364.07,374.93,387.47,398.31,408.62,415.9,424.89,433.49,440.61,454.46,464.39,474.7,477.68,497.54,503.15,507.83,516.24,524.09,530.8,535.1,542.38,547.23,550.4,551.72,553.03,555.09,557.52,559.73,561.29,563.15,564.46,564.8,567,567.51,568.64,569.96,570.89,571.64,572.76,573.32,574.07,574.63,575.39,575.94,576.56,576.88,577.63,578.19,578.75,579.31,579.86,580.25,580.8,581.1,581.55,581.83,582.39,582.71,583.21,583.51,583.96,584.24,584.78,585.13,586.22,586.62,587.52,587.9,589.71,590.1,591.42,591.83,592.86,593.25])
deriReal = np.array([1.7098,2.4958,4.4916,7.4107,10.0963,12.8207,15.1382,17.0691,19.4921,17.1346,21.419,27.9062,35.5838,36.0873,40.0996,59.2751,64.3431,53.1749,60.0963,62.9027,69.4071,81.8344,88.7436,95.4434,101.4855,107.8807,114.7506,126.5068,142.306,155.2165,151.546,158.0667,175.478,192.559,177.4633,184.2295,202.9277,173.6664,187.2953,210.934,182.7992,194.7352,195.1176,200.1915,210.0963,201.1232,174.7776,178.1645,193.8354,180.5007,169.6267,153.1716,142.935,96.301,89.7894,124.5963,97.7732,90.6307,89.6178,87.2892,70.836,83.0795,90.3366,63.7965,37.4576,23.8049,32.6983,45.4847,49.0577,41.3656,39.7761,38.2492,22.7654,18.3097,19.0236,13.213,20.205387,19.707,15.756,18.756,17.1367,14.4583,14.9275,15.8172,16.2879,15.2523,12.5318,11.1707,12.8853,11.6352,12.2291,12.8085,11.1516,11.8288,11.022,10.2644,10.2107,10.0441,10.0083,9.9814,9.9659,9.929,9.8879,9.9722,9.9844,9.8985,9.8435,9.8889,9.8851,9.8516,9.8177,9.7815,9.8236,9.8396,9.8026,9.8448])
tde = np.array([0.001799994,0.003499977,0.007099907,0.010599792,0.014199627,0.01769942,0.02129916,0.024798861,0.028298517,0.031898116,0.038997184,0.042496655,0.049595445,0.056694047,0.063792463,0.070790719,0.081487701,0.092084295,0.102680472,0.113276233,0.123971532,0.138064691,0.152257058,0.166448678,0.18053962,0.194729753,0.21241641,0.247786248,0.28315145,0.318611901,0.353967823,0.389319113,0.424665772,0.460007801,0.4953452,0.530777774,0.566105903,0.601429406,0.636748283,0.689717927,0.742776894,0.795725715,0.84866414,0.901592171,0.954609457,1.00751669,1.060413538,1.113300005,1.166275661,1.219141354,1.271996675,1.377775701,1.483413745,1.589109772,1.694664944,1.905750467,2.01128079,2.11667051,2.327425266,2.538014929,2.748439695,2.958699756,3.168795305,3.378726537,3.588493642,3.798096814,4.007536245,4.216812127,4.42592465,4.634874007,4.843660389,5.052283985,5.260744986,5.677179963,6.092966837,6.508107119,6.922602317,7.336453933,7.749663465,8.162232405,8.574162243,8.985454463,9.396110542,9.806131958,10.21552018,10.62427667,11.03240289,11.43990031,12.04997058,12.65863418,13.26589595,13.87176075,14.47623339,15.07931865,15.68102131,16.28134611,16.8802978,17.47788106,18.27253819,19.06478194,19.85462329,20.64207316,21.42714238,22.20984174,23.18489964,24.35013263,26.28055494,28.19657745,30.09836066,31.98606272,34.84625379,39.39914163,43.02513847,46.59898477,50.12179756,53.59466222])

# Calculando a matriz pwd
for j in range(len(cde2s)):
    for i in range(len(tD)):
        f = lambda u:(
            (1/(u*(1/(0.5*np.log(4*cde2s[j]/(np.exp(Ceuler**2)*u)))+u)))
        )
        var = invlaplace(tD[i],f, 8)
        pwd[j][i] = var.gavsteh(f,tD[i],8)

deri=np.zeros_like(pwd)
for j in range(len(cde2s)):
    for i in range(len(tD)-1):
        deri[j][i]=tD[i]*(pwd[j,i+1]-pwd[j,i])/((max(tD)-min(tD))/len(tD))

# Plotando as curvas

fig, ax = plt.subplots()
colors = plt.cm.jet(np.linspace(0, 1, len(cde2s)))
for j in range(len(cde2s)):
    color = colors[j]
    ax.plot(tD, pwd[j][:], color=color)
    ax.plot(tD,deri[j][:],ls="--", color=color)

# Adicionando linhas de referência para a legenda
line_func = ax.plot([], [], color='black', label='Pwd')[0]
line_deriv = ax.plot([], [], color='black', ls='--', label='Pwd\'')[0]

# Plot dos dados reais
plt.loglog(tde*30,(pwReal*0.045),'o',markersize=3,label='Dados de Produção')
plt.loglog(tde*30,deriReal*0.045,'o',markersize=3,markerfacecolor='none',label='Derivada dos Dados')
plt.loglog(1,10,'o',color='red',markersize=4)
plt.text(1, 10, 'match-point', fontsize=6, ha='center', va='bottom')
# Adicionando a legenda
ax.legend(handles=[line_func, line_deriv])
# Adicionando rótulos e título
plt.legend()
plt.xscale('log')
plt.yscale('log')
plt.xlabel('Dimensionless Time, tD/cD')
plt.ylabel('Dimensionless Pressure, pwd')
plt.title('Gringarten-Bourdet Type Curves')
plt.axis([1e-1, 1e4, 1e-1, 1e2])
plt.grid(True, which="both", ls="--")
plt.show()
